<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title></title>
  <style>
    * {
      margin: 0;
      padding: 0;
    }
    .clearfix:after{display:block;clear:both;content:"";visibility:hidden;height:0}
    .clearfix{zoom:1}
    .swiper-container{
      position:relative;
      width: 755px;
      margin: 100px auto; 
    }
    .swiper-wrapper{
      width: 375px;
      height: 200px;
      overflow: hidden;
      margin: 0 auto; 
    }
    ul{
      position: relative;
      list-style: none;
    }
    .item{
      float: left;
      width: 375px;
      height: 200px;
    }
    .btn{
      position: absolute;
      top: 50%;
      margin-top: -27.5px;
      z-index: 999;
      background: rgba(25,155,85,0.5);
      height: 55px;
      line-height: 55px;
    }
    .prevBtn{
      left: 0;

    }
    .nextBtn{
      right: 0;
    }
    .box{
      position: relative;
      width: 20px;
      height: 20px;
      background: red;
    }
  </style>
</head>
<body>
  <div class="swiper-container">
    <a href="javascript:;" class="prevBtn btn ">
      <img src="./images/prev.png" alt="">
    </a>
    <div class="swiper-wrapper">
      <ul class="clearfix wrapper">
        <li class="item">
           <img src="./images/banner-01.jpg" alt="">
        </li>
        <li class="item">
            <img src="./images/banner-02.jpg" alt="">
        </li>
        <li class="item">
            <img src="./images/banner-03.jpg" alt="">
        </li>
      </ul>
    </div>
    <a href="javascript:;" class="nextBtn btn">
      <img src="./images/next.png" alt="">
    </a>
  </div>

  <div class="box"></div>

  <script>
    /*
      1.将最 最前一个 iten 复制一份 放在 最后,
        将最 最后一个 iten 复制一份 放在 最前;
      2.计算 item 的数量 之和 赋值给 ul 

    */ 
    (function(){
      
    function Swiper(option){
      this.ele = option.ele || ".swiper-wrapper";
      this.wrapper = option.wrapper || ".wrapper";
      this.item = option.item || ".item";
      this.prevBtn = option.prevBtn || ".prevBtn";
      this.nextBtn = option.nextBtn || ".nextBtn";
      this.direction = option.direction || "horizontal";  /* horizontal： 横向; vertical: 垂直 */
      this.loop = option.loop || false;   /* loop 功能，添加内容 */
      this.ms = option.ms || 0;
      this.initialItem = option.initialItem || this.loop? 1 : 0;
      this.lock = true;
    }
    Swiper.prototype = {
      init(){
        this.showDirection();
        this.leftShift();
        this.rightShift();
        this.wrapperFn();

        this.animate(document.querySelector(".box"),{left:250,top: 250}, 20,function(){
          console.log("动画完了");
        })
      },
      obtainEle(str){
        return document.querySelector(str);
      },
      wrapperFn(){
        this.obtainEle(this.wrapper).onclick = function(e){
          console.log(e);
          console.log(e.offsetY);
        }
      },
      leftShift(){
        var _this = this;
        this.obtainEle(this.prevBtn).onclick = function(){
          if(_this.lock){
            _this.lock = false;
            var initialItem = _this.initialItem -= 1
            if(initialItem < 0 && !_this.loop) {
              _this.initialItem = 0;
              _this.lock = true;
              return false;
            }
            _this.transform(initialItem);
            _this.transition(_this.ms);
            var transitionFlag = true;
            _this.obtainEle(_this.wrapper).addEventListener("transitionend",function(e){
                 if(e.target === e.currentTarget && transitionFlag) {
                    transitionFlag = false;
                    _this.lock = true;
                    if(_this.initialItem <= 0 && _this.loop){
                      _this.initialItem = _this.wrapperNodeNum(_this.obtainEle(_this.wrapper)).length - 2;
                      _this.transform(_this.initialItem);
                      _this.transition(0);
                    }
                 }
             },false)
          }
        }
      },
      rightShift(){
        var _this = this;
       this.obtainEle(this.nextBtn).onclick=function(){
          if(_this.lock){
            _this.lock = false;
             var initialItem = _this.initialItem += 1
            if(initialItem > _this.wrapperNodeNum(_this.obtainEle(_this.wrapper)).length - 1 && !_this.loop) {
              _this.initialItem = _this.wrapperNodeNum(_this.obtainEle(_this.wrapper)).length - 1;
              _this.lock = true;
              return false;
            }
            _this.transform(initialItem);
            _this.transition(_this.ms);
            var transitionFlag = true;
            _this.obtainEle(_this.wrapper).addEventListener("transitionend",function(e){
                 if(e.target === e.currentTarget && transitionFlag) {
                      transitionFlag = false;
                      _this.lock = true;
                      if(_this.initialItem >= _this.wrapperNodeNum(_this.obtainEle(_this.wrapper)).length - 1 && _this.loop){
                          _this.initialItem = 1;
                        _this.transform(_this.initialItem);
                        _this.transition(0);
                      }
                  }              
            },false)
        }
      };
       
       
      },
      /* 显示 方向 horizontal： 横向; vertical: 垂直 */ 
      showDirection(){
        var _this = this;
         if(_this.loop) _this.isLoop();
         if(_this.direction === "horizontal"){
            _this.obtainEle(_this.wrapper).style.width = _this.wrapperNodeNum(_this.obtainEle(_this.wrapper)).length * _this.getStyleValue(_this.obtainEle(_this.item),"width") + "px";
         } else if(_this.direction === "vertical"){
            _this.obtainEle(_this.wrapper).style.height = _this.wrapperNodeNum(_this.obtainEle(_this.wrapper)).length * _this.getStyleValue(_this.obtainEle(_this.item),"height") + "px";
         }
         /* 禁止 img 拖动 */
         _this.clickImg();
         /* 移动 item  */
         _this.transform();
         /* 移动速度 */ 
         _this.transition();
      },
      /* 获取 wrapper 下的 item 的数量 */ 
      wrapperNodeNum(wrapperNode){
        var wrapperNum;
        wrapperNode.childNodes.forEach((key,index)=>{
          if(key.nodeName == "#text" && /\s/.test(key.nodeValue)) {
            wrapperNode.removeChild(key);
            wrapperNum = wrapperNode.childNodes;
          }else{
            wrapperNum = wrapperNode.childNodes;
          }
        })
        return wrapperNum;
      },
      /* loop 功能，添加内容 */
      isLoop(){
        let wrapper = this.wrapperNodeNum(this.obtainEle(this.wrapper)),    
            firstLi = document.createElement("li"),
            lastLi = document.createElement("li");
        firstLi.className = "item";
        lastLi.className = "item";
        firstLi.innerHTML = wrapper[wrapper.length - 1].innerHTML;
        lastLi.innerHTML = wrapper[0].innerHTML;
        wrapper[0].before(firstLi);
        wrapper[wrapper.length - 1].after(lastLi);
      },
        /* 禁止 img 拖动 */
      clickImg(){  
        var imgList = this.obtainEle(this.wrapper).getElementsByTagName("img");
        for(var key in imgList){
          if(/^[0-9]$/.test(key)){
            imgList[key].onmousedown = function(e){
              e.preventDefault()
            }
          }
        }
      },
      /* 获取 元素的 css 属性的值  */ 
      getStyleValue(node, attr){
        let styleNode;
        if(node.currentStyle == undefined){
          styleNode = getComputedStyle(node,null);
        }else{
          styleNode = node.currentStyle;
        }
        return parseInt(styleNode[attr]);
      },
      transform(itemIndex){
        let eleWidth = this.getStyleValue(this.obtainEle(this.item),"width"),
            eleHeight = this.getStyleValue(this.obtainEle(this.item),"height");
        if(this.direction == "horizontal"){
          let num = itemIndex || itemIndex == 0? itemIndex * eleWidth : this.loop?  eleWidth : 0 ;
          this.obtainEle(this.wrapper).style['-webkit-transform'] = 'translate3d('+ -num +'px, 0, 0)';
          this.obtainEle(this.wrapper).style['transform'] = 'translate3d('+ -num +'px, 0, 0)';
        }else if(this.direction == "vertical"){
          let num = itemIndex || itemIndex == 0? itemIndex * eleHeight : this.loop? eleHeight : 0 ;
          this.obtainEle(this.wrapper).style['-webkit-transform'] = 'translate3d(0, '+ -num +'px, 0)';
          this.obtainEle(this.wrapper).style['transform'] = 'translate3d(0, '+ -num +'px, 0)';
        }
      },
      transformEnd(){
        console.log("transformEnd");
      },
      transition(ms){
        var num = ms || ms == 0? ms : this.ms;
        this.obtainEle(this.wrapper).style['-webkit-transition'] = 'all '+ num +'s ease';
        this.obtainEle(this.wrapper).style["transition"] = 'all '+ num +'s ease';
      },
      transitionEnd(){

      },
      /* 动画 */ 
      animate(node, obj, speed, fn){
        var _this = this;
        clearInterval(node.num);
        node.num = setInterval(function(){
          var flag = true;
          for(var key in obj){
            var v = parseInt(_this.getStyleValue(node,key));
            if(v != obj[key]){
              flag = false;
            }
            var step = (obj[key] - v) / 40;
            if(step > 0){
              step = Math.ceil(step);
            }else{
              step = Math.floor(step);
            }
            var v2 = v + step;
            node.style[key] = v2 +"px";
          }
          if(flag){
            clearInterval(node.num);
            if(fn != undefined){
              fn();
            }
          }
        },speed)
      }
    }

    new Swiper({
      loop:true,
      ms:0.5
    }).init()
    
    }());
     
  </script>
</body>
</html>