<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title></title>
  <style>
    *{
      margin: 0;
      padding: 0;
    }
    .container{
      width: 800px;
      height: 600px;
      background: #c2c2c2;
      margin: 0 auto;
      position: relative;
    }
  </style>
</head>
<body>
  <div class="container"></div>
  <script>
  class Food {
        constructor(foodX,foodY,FoodWidth,FoodHeight,foodColor){

          /* 游戏地图 */ 
          this.conBox = document.querySelector(".container");

          /* food 在地图中的坐标 */ 
          this.foodX = foodX || 0;
          this.foodY = foodY || 0;

          /* food 在地图中的宽高 */ 
          this.foodWidth = FoodWidth || 20;
          this.foodHeight = FoodHeight || 20;  

           /* food 在地图中的颜色 */ 
          this.foodColor = foodColor || "green";

          /* 增删 food  */
          this.foodEle = []; 

        }
        createFood(){

            /* 删除上一个食物  */ 
            this.removeFood();

            /* 创建food */ 
            var div = document.createElement("div");
            this.conBox.appendChild(div);
            this.foodEle.push(div);

            /* 计算食物的坐标 */ 
            this.foodX = parseInt(Math.random() * (this.conBox.offsetWidth / this.foodWidth)) * this.foodWidth;
            this.foodY = parseInt(Math.random() * (this.conBox.offsetHeight / this.foodHeight)) * this.foodHeight;

            /* 设置 style 属性 */ 
            div.style.width = this.foodWidth +"px";
            div.style.height = this.foodHeight +"px";
            div.style.background = this.foodColor;
            div.style.position = "absolute";
            div.style.left = this.foodX + "px";
            div.style.top = this.foodY + "px";
        }
        removeFood(){
            this.foodEle.forEach((key,index) =>{

              let ele = key;

              /* 通过 ele 的父元素 删除 ele  */ 
              ele.parentNode.removeChild(ele);

              this.foodEle.splice(index,1);
            })
        }
      }

      class Snake extends Food{
        constructor(snakeWidth,snakeHeight,direction){
          super();

          /* 蛇的宽高 */
          this.snakeWidth =  snakeWidth || 20;
          this.snakeHeight = snakeHeight || 20;

          /* 蛇的主体 */ 
          this.body =[
            {x:3,y:2,color:"red"},
            {x:2,y:2,color:'yellow'},
            {x:1,y:2,color:'yellow'},
          ]

          /* 蛇头的方向 */
          this.direction = direction || "right"; 

          /* 蛇的 */
          this.snakeEle = []; 

        }
        snakeInit(){  // 初始化
          this.createSnake();
        }
        createSnake(){   // 创造蛇

            this.removeSnake();

            this.body.forEach((key,index) =>{

              /* 创建 div 蛇*/ 
              var div = document.createElement("div");
               
              /* 设置蛇的样式 */ 
              div.style.width = this.snakeWidth + "px";
              div.style.height = this.snakeHeight + "px";
              div.style.position = "absolute";
              div.style.background = key.color;
              div.style.left = key.x * this.snakeWidth + "px";
              div.style.top = key.y * this.snakeHeight + "px";

              /* 将蛇放到 图片中 */ 
              this.conBox.appendChild(div);

              /*  */ 
              this.snakeEle.push(div);
            })
        }
        moveSnake(){
          /* 将前一个的位置 赋值 给后一个 */ 
          var i = this.body.length - 1;//2
          for (; i > 0; i--) {
              this.body[i].x = this.body[i - 1].x;
              this.body[i].y = this.body[i - 1].y;
          }

          /* 判断 方向 */ 
          switch(this.direction){
            case "right":
              this.body[0].x += 1;
              break;
            case "left":
              this.body[0].x -= 1;
              break;
            case "top":
              this.body[0].y -= 1;
              break;
            case "bottom":
              this.body[0].y += 1;
              break;
          }

          /* 获取蛇头的位置  */ 
          var headX = this.body[0].x * this.snakeWidth;
          var headY = this.body[0].y * this.snakeHeight;

          /* 吃到食物 */ 
          if(headX === this.foodX && headY === this.foodY){

              /* 获取 蛇 最后一个 div */ 
              var lastEle = this.body[this.body.length - 1];
              
              /* 添加 最后一个 div ， 并赋值 */ 
              this.body.push({
                x:lastEle.x,
                y:lastEle.y,
                color:lastEle.color
              })

              /* 重新 获取 食物 */ 
              this.createFood();
          }

        }
        removeSnake(){

          var i = this.snakeEle.length - 1;
          for (; i >= 0; i--) {
              //先从当前的子元素中找到该子元素的父级元素,然后再弄死这个子元素
              var ele = this.snakeEle[i];
              //从map地图上删除这个子元素div
              ele.parentNode.removeChild(ele);
              this.snakeEle.splice(i, 1);
          }
        }
      }
      
      class Game extends Snake{
        constructor(){
          super();
        }
        init(){
          
        /* 初始化食物 */ 
         this.createFood();

         /* 按下键盘 */ 
         this.bindKey();

         /* 移动 蛇 的位置 */ 
         this.runSnake();
        }
        runSnake(){
          var timeId = setInterval(function(){
            this.moveSnake();
            this.snakeInit();

            /* 获取 蛇头 最大的 X，Y 的数值 */ 
            var maxX = this.conBox.offsetWidth / this.snakeWidth;
            var maxY = this.conBox.offsetHeight / this.snakeHeight;

            /* 获取 蛇头 的位置 */ 
            var headX = this.body[0].x;
            var headY = this.body[0].y;

            /* 撞到墙 */ 
            if(headX < 0 || headX >= maxX){
              alert("你还玩什么啊！ 都死了");
              clearInterval(timeId);
            }
            if(headY < 0 || headY >= maxY){
              alert("你还玩什么啊！ 都死了");
              clearInterval(timeId);
            }

          }.bind(this),300)
        }
        bindKey(){
          document.addEventListener("keydown",function(e){
            console.log();
            switch (e.keyCode){
              case 37: 
                this.direction = "left";
                break;
              case 38: 
                this.direction = "top";
                break;
              case 39: 
                this.direction = "right";
                break;
              case 40: 
                this.direction = "bottom";
                break;
            }
          }.bind(this),false)
        }
      }

    new Game().init();
 
  </script>
</body>
</html>